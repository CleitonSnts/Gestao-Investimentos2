<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Investimentos - Meu Curso</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .blink {
            animation: blink-animation 1s steps(2, start) infinite;
        }
        @keyframes blink-animation {
            to { visibility: hidden; }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="gradient-bg text-white py-8 px-4 shadow-lg">
        <div class="container mx-auto">
            <h1 class="text-3xl font-bold mb-2">Gestão de Investimentos</h1>
            <p class="opacity-90">Registre seus ativos e acompanhe seu desempenho</p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Painel de Operações -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Nova Operação</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-gray-700 mb-1">Tipo</label>
                    <select id="tipoOperacao" class="w-full px-4 py-2 border rounded-lg">
                        <option value="compra">Compra</option>
                        <option value="venda">Venda</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Ativo (ex: PETR4)</label>
                    <input type="text" id="nomeAtivo" class="w-full px-4 py-2 border rounded-lg" placeholder="Código do ativo">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Quantidade</label>
                    <input type="number" id="quantidade" class="w-full px-4 py-2 border rounded-lg" placeholder="Ex: 100">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Preço Unitário (R$)</label>
                    <input type="number" step="0.01" id="precoUnitario" class="w-full px-4 py-2 border rounded-lg" placeholder="Ex: 32.50">
                </div>
            </div>
            <button id="registrarBtn" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg">
                Registrar Operação
            </button>
        </div>

        <!-- Dashboard -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <!-- Resumo -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Resumo</h2>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Total Investido:</span>
                        <span class="font-medium" id="totalInvestido">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Valor Atual:</span>
                        <span class="font-medium" id="valorAtual">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Rentabilidade:</span>
                        <span class="font-medium" id="rentabilidade">0,00%</span>
                    </div>
                </div>
                <button onclick="exportarDados()" class="mt-6 w-full bg-green-600 text-white py-2 rounded-lg">
                    Exportar Meus Dados
                </button>
            </div>

            <!-- Gráfico -->
            <div class="bg-white rounded-xl shadow-md p-6 lg:col-span-2">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Distribuição da Carteira</h2>
                <canvas id="distribuicaoChart"></canvas>
            </div>
        </div>

        <!-- Lista de Ativos -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8 overflow-x-auto">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Seus Ativos</h2>
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ativo</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantidade</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Preço Médio</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor Investido</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rentabilidade</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="ativosBody">
                    <!-- Dados serão preenchidos automaticamente -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Dados da carteira
        let carteira = {
            ativos: {},
            operacoes: [],
            precosAtuais: {
                'PETR4': 33.50,
                'VALE3': 68.42,
                'ITUB4': 22.10,
                'MXRF11': 9.85
                // Adicione outros ativos conforme necessário
            }
        };

        // Elementos do DOM
        const registrarBtn = document.getElementById('registrarBtn');
        const ativosBody = document.getElementById('ativosBody');

        // Carregar dados salvos ao iniciar
        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
            criarGrafico();
            registrarBtn.addEventListener('click', registrarOperacao);
        });

        // Registrar nova operação
        function registrarOperacao() {
            const ativo = document.getElementById('nomeAtivo').value.trim().toUpperCase();
            const qtd = parseFloat(document.getElementById('quantidade').value);
            const preco = parseFloat(document.getElementById('precoUnitario').value);
            const tipo = document.getElementById('tipoOperacao').value;

            // Validar dados
            if (!ativo || isNaN(qtd) || qtd <= 0 || isNaN(preco) || preco <= 0) {
                alert("Preencha todos os campos corretamente!");
                return;
            }

            // Criar operação
            const operacao = {
                id: Date.now(),
                tipo,
                ativo,
                quantidade: qtd,
                precoUnitario: preco,
                data: new Date().toLocaleDateString('pt-BR')
            };

            // Processar operação
            processarOperacao(operacao);
            salvarDados();
            atualizarInterface();
            limparFormulario();
        }

        function processarOperacao(op) {
            carteira.operacoes.push(op);

            // Inicializar ativo se não existir
            if (!carteira.ativos[op.ativo]) {
                carteira.ativos[op.ativo] = {
                    quantidade: 0,
                    precoMedio: 0,
                    valorInvestido: 0
                };
            }

            const ativo = carteira.ativos[op.ativo];

            if (op.tipo === 'compra') {
                // Atualizar preço médio
                ativo.precoMedio = (
                    (ativo.valorInvestido + (op.quantidade * op.precoUnitario)) / 
                    (ativo.quantidade + op.quantidade)
                );
                ativo.quantidade += op.quantidade;
                ativo.valorInvestido = ativo.quantidade * ativo.precoMedio;
            } else {
                // Validar venda
                if (op.quantidade > ativo.quantidade) {
                    alert("Você não possui essa quantidade para vender!");
                    return;
                }
                ativo.quantidade -= op.quantidade;
                ativo.valorInvestido = ativo.quantidade * ativo.precoMedio;
            }
        }

        // Atualizar interface
        function atualizarInterface() {
            let totalInvestido = 0;
            let valorAtual = 0;
            ativosBody.innerHTML = '';

            for (const [ativo, dados] of Object.entries(carteira.ativos)) {
                if (dados.quantidade <= 0) continue;

                const precoAtual = carteira.precosAtuais[ativo] || dados.precoMedio;
                const valorAtualAtivo = dados.quantidade * precoAtual;
                const rentabilidade = ((valorAtualAtivo - dados.valorInvestido) / dados.valorInvestido * 100);

                totalInvestido += dados.valorInvestido;
                valorAtual += valorAtualAtivo;

                ativosBody.innerHTML += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap font-medium">${ativo}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${dados.quantidade}</td>
                        <td class="px-6 py-4 whitespace-nowrap">R$ ${dados.precoMedio.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap">R$ ${dados.valorInvestido.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap ${rentabilidade >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${rentabilidade.toFixed(2)}%
                        </td>
                    </tr>
                `;
            }

            // Atualizar totais
            document.getElementById('totalInvestido').textContent = `R$ ${totalInvestido.toFixed(2)}`;
            document.getElementById('valorAtual').textContent = `R$ ${valorAtual.toFixed(2)}`;
            document.getElementById('rentabilidade').textContent = 
                `${(((valorAtual - totalInvestido) / totalInvestido) * 100).toFixed(2)}%`;
        }

        // Gráfico
        function criarGrafico() {
            const ctx = document.getElementById('distribuicaoChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#3b82f6', '#10b981', '#f59e0b', '#6366f1'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        function atualizarGrafico() {
            // Implementação similar à anterior
        }

        // Sistema de persistência
        function salvarDados() {
            localStorage.setItem('minhaCarteira', JSON.stringify(carteira));
        }

        function carregarDados() {
            const dados = localStorage.getItem('minhaCarteira');
            if (dados) {
                carteira = JSON.parse(dados);
                atualizarInterface();
            }
        }

        function exportarDados() {
            const data = JSON.stringify(carteira);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-carteira-${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function limparFormulario() {
            document.getElementById('nomeAtivo').value = '';
            document.getElementById('quantidade').value = '';
            document.getElementById('precoUnitario').value = '';
        }
    </script>
</body>
</html>
